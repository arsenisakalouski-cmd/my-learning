import requests
import json
from datetime import datetime

WEATHER_API_KEY = "abf50edc8408656d0c342adb43c7e925"

# –§–∞–π–ª—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
WEATHER_FILE = "weather_history.json"
QUOTES_FILE = "saved_quotes.json"

def load_json(filename):
    try:
        with open(filename, "r", encoding="utf-8") as f:
            return json.load(f)
    except FileNotFoundError:
        return[]
    except json.JSONDecodeError:
        print(f" –§–∞–π–ª {filename} –ø–æ–≤—Ä–µ–∂–¥—ë–Ω, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π")
        return []
    
def save_json(data, filename):
    try :
        with open(filename, "w", encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        print(f" –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {filename}")
    except Exception as e:
        print(f" –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: {e}")

def get_weather(city):
    if WEATHER_API_KEY == "abf50edc8408656d0c342adb43c7e925" : 
        print("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WEATHER_API_KEY –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–≥–æ–¥–æ–π")
        return None
     
    url = "http://api.openweathermap.org/data/2.5/weather"
    params = {
        "q": city,
        "appid": WEATHER_API_KEY,
        "units": "metric",
        "lang": "ru"
    }
     
    try:
        response = requests.get(url, params=params, timeout=5)
        
        if response.status_code == 200:
            return response.json()
        elif response.status_code == 404:
            print(f" –ì–æ—Ä–æ–¥ '{city}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
        elif response.status_code == 401:
            print(" –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á")
        else:
            print(f" –û—à–∏–±–∫–∞ {response.status_code}")
        
        return None
    
    except requests.RequestException as e:
        print(f" –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: {e}")
        return None
    

def save_weather(city, weather_data):
     # –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å
    record = {
        "city": city,
        "temperature": weather_data['main']['temp'],
        "description": weather_data['weather'][0]['description'],
        "humidity": weather_data['main']['humidity'],
        "wind_speed": weather_data['wind']['speed'],
        "timestamp": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    }
    
    history.append(record)
    save_json(history, WEATHER_FILE)

    
def get_random_quote():
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—É—é —Ü–∏—Ç–∞—Ç—É"""
    url = "https://api.quotable.io/random"
    
    try:
        response = requests.get(url, timeout=5)
        if response.ok:
            return response.json()
        return None
    except requests.RequestException as e:
        print(f" –û—à–∏–±–∫–∞: {e}")
        return None


def save_quote(quote_data):
    """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–∏—Ç–∞—Ç—É –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"""
    quotes = load_json(QUOTES_FILE)
    
    record = {
        "content": quote_data['content'],
        "author": quote_data['author'],
        "saved_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    }
    
    quotes.append(record)
    save_json(quotes, QUOTES_FILE)
    print(" –¶–∏—Ç–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!")

def show_saved_quotes():
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã"""
    quotes = load_json(QUOTES_FILE)
    
    if not quotes:
        print("\nüìã –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ü–∏—Ç–∞—Ç\n")
        return
    
    print("\n" + "="*70)
    print(" –°–û–•–†–ê–ù–Å–ù–ù–´–ï –¶–ò–¢–ê–¢–´")
    print("="*70)
    
    for i, quote in enumerate(quotes, 1):
        print(f"\n{i}. \"{quote['content']}\"")
        print(f"   ‚Äî {quote['author']}")
        print(f"    –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {quote['saved_at']}")
    
    print("\n" + "="*70 + "\n")




def get_exchange_rate(from_curr, to_curr):
    """–ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å –æ–±–º–µ–Ω–∞"""
    url = f"https://api.exchangerate-api.com/v4/latest/{from_curr}"
    
    try:
        response = requests.get(url, timeout=5)
        if response.ok:
            data = response.json()
            if to_curr in data['rates']:
                return data['rates'][to_curr]
        return None
    except requests.RequestException as e:
        print(f" –û—à–∏–±–∫–∞: {e}")
        return None\
        
def currency_converter():
    """–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç"""
    print("\n" + "üí±"*35)
    print("           –ö–û–ù–í–ï–†–¢–ï–† –í–ê–õ–Æ–¢")
    print("üí±"*35)
    
    try:
        amount = float(input("\n–°—É–º–º–∞: "))
        from_curr = input("–ò–∑ –≤–∞–ª—é—Ç—ã (USD, EUR, RUB...): ").strip().upper()
        to_curr = input("–í –≤–∞–ª—é—Ç—É (USD, EUR, RUB...): ").strip().upper()
        
        rate = get_exchange_rate(from_curr, to_curr)
        
        if rate:
            result = amount * rate
            print(f"\n {amount} {from_curr} = {result:.2f} {to_curr}")
            print(f"   –ö—É—Ä—Å: 1 {from_curr} = {rate:.4f} {to_curr}\n")
        else:
            print(" –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å\n")
    
    except ValueError:
        print(" –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ\n")


def generate_random_users(count=5):
    """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    url = f"https://randomuser.me/api/?results={count}"
    
    try:
        response = requests.get(url, timeout=5)
        if response.ok:
            data = response.json()
            return data['results']
        return None
    except requests.RequestException as e:
        print(f" –û—à–∏–±–∫–∞: {e}")
        return None
    


def show_random_users():
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    print("\n‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...\n")
    
    users = generate_random_users(5)
    
    if not users:
        print(" –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n")
        return
    
    print("="*70)
    print(" –°–õ–£–ß–ê–ô–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò")
    print("="*70)
    
    for i, user in enumerate(users, 1):
        name = f"{user['name']['first']} {user['name']['last']}"
        email = user['email']
        country = user['location']['country']
        age = user['dob']['age']
        
        print(f"\n{i}. {name}")
        print(f"    {email}")
        print(f"    {country}, {age} –ª–µ—Ç")
    
    print("\n" + "="*70 + "\n")



def show_menu():
    """–ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    print("\n" + "üåê"*35)
    print("              DATA HUB - –¶–ï–ù–¢–† –î–ê–ù–ù–´–•")
    print("üåê"*35)
    print("\n1. üå§Ô∏è  –ü–æ–≥–æ–¥–∞")
    print("2. üí¨ –°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞")
    print("3. üí± –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç")
    print("4. üë• –°–ª—É—á–∞–π–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏")
    print("5. üìä –ò—Å—Ç–æ—Ä–∏—è –ø–æ–≥–æ–¥—ã")
    print("6. üíæ –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã")
    print("7. üö™ –í—ã—Ö–æ–¥")
    print("\n" + "="*70)


def weather_menu():
    """–ú–µ–Ω—é –ø–æ–≥–æ–¥—ã"""
    city = input("\nüåç –í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥: ").strip()
    
    if not city:
        print(" –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞!\n")
        return
    
    print(f"\ –ü–æ–ª—É—á–∞—é –ø–æ–≥–æ–¥—É –¥–ª—è {city}...\n")
    
    weather = get_weather(city)
    
    if weather:
        print("="*50)
        print(f"  –ü–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ: {weather['name']}")
        print("="*50)
        print(f"  –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {weather['main']['temp']}¬∞C")
        print(f" –û—â—É—â–∞–µ—Ç—Å—è: {weather['main']['feels_like']}¬∞C")
        print(f"  {weather['weather'][0]['description'].capitalize()}")
        print(f" –í–ª–∞–∂–Ω–æ—Å—Ç—å: {weather['main']['humidity']}%")
        print(f" –í–µ—Ç–µ—Ä: {weather['wind']['speed']} –º/—Å")
        print("="*50 + "\n")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        save_weather(city, weather)


def quote_menu():
    """–ú–µ–Ω—é —Ü–∏—Ç–∞—Ç"""
    print("\n –ü–æ–ª—É—á–∞—é —Ü–∏—Ç–∞—Ç—É...\n")
    
    quote = get_random_quote()
    
    if quote:
        print("="*70)
        print(" –¶–ò–¢–ê–¢–ê –î–ù–Ø")
        print("="*70)
        print(f"\n\"{quote['content']}\"\n")
        print(f"‚Äî {quote['author']}")
        print("\n" + "="*70)
        
        save_choice = input("\n –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–∏—Ç–∞—Ç—É? (–¥–∞/–Ω–µ—Ç): ").strip().lower()
        if save_choice == "–¥–∞":
            save_quote(quote)
        print()


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    print("\n" + ""*35)
    print("         –î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í DATA HUB!")
    print(""*35)
    
    while True:
        show_menu()
        
        try:
            choice = input("\n–í—ã–±–æ—Ä (1-7): ").strip()
            
            if choice == "1":
                weather_menu()
            
            elif choice == "2":
                quote_menu()
            
            elif choice == "3":
                currency_converter()
            
            elif choice == "4":
                show_random_users()
            
            elif choice == "5":
                show_weather_history()
            
            elif choice == "6":
                show_saved_quotes()
            
            elif choice == "7":
                print("\n –°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ! –î–æ –≤—Å—Ç—Ä–µ—á–∏!\n")
                break
            
            else:
                print("\n –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç 1 –¥–æ 7\n")
        
        except KeyboardInterrupt:
            print("\n\n –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞")
            print(" –î–æ –≤—Å—Ç—Ä–µ—á–∏!\n")
            break
        
        except Exception as e:
            print(f"\n –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}\n")



if __name__ == "__main__":
    main()

