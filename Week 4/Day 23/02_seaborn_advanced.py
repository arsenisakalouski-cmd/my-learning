import seaborn as sns
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np


sns.set_theme(style="whitegrid")
"""
style="whitegrid" - стиль с белым фоном и серой сеткой
Другие стили:
- "darkgrid" - тёмная сетка
- "white" - белый без сетки
- "dark" - тёмный без сетки
- "ticks" - с делениями
"""
print("="*60)
print("ПРОДВИНУТЫЕ ГРАФИКИ Seaborn")
print("="*60)


print("\n1. Создаём реалистичные данные о продажах:")

# Установить seed для одинаковых случайных чисел
np.random.seed(42)

# Создать данные о продажах магазинов
data = {
    'Месяц': ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'] * 3,  # 6 месяцев × 3 магазина = 18 строк
    'Магазин': ['А']*6 + ['Б']*6 + ['В']*6,  # Магазин А 6 раз, Б 6 раз, В 6 раз
    'Продажи': np.random.randint(100, 300, 18),  # 18 случайных чисел от 100 до 300
    'Расходы': np.random.randint(50, 150, 18),
    'Регион': ['Москва']*6 + ['СПб']*6 + ['Казань']*6
}

df = pd.DataFrame(data)
print("\nПервые 10 строк данных:")
print(df.head(10))
"""
head(10) - показать первые 10 строк
Результат:
Месяц | Магазин | Продажи | Расходы | Регион
Янв   | А       | 202     | 102     | Москва
Фев   | А       | 186     | 102     | Москва
...
"""

# ============================================
# ГРАФИК 1: ЛИНИИ С ДОВЕРИТЕЛЬНЫМ ИНТЕРВАЛОМ
# ============================================

print("\n2. График с доверительным интервалом:")

plt.figure(figsize=(12, 6))

# Нарисовать линии для каждого магазина
sns.lineplot(data=df, x='Месяц', y='Продажи', hue='Магазин', 
             marker='o', markersize=8, linewidth=2)
"""
ПОДРОБНО:

x='Месяц' - месяцы по горизонтали
y='Продажи' - продажи по вертикали
hue='Магазин' - разные цвета для разных магазинов

marker='o' - кружочки на точках
markersize=8 - размер кружочков
linewidth=2 - толщина линии

Seaborn АВТОМАТИЧЕСКИ:
1. Вычисляет среднее если есть несколько значений
2. Рисует затемнённую область (доверительный интервал)
3. Создаёт легенду с названиями магазинов
"""

plt.title('Динамика продаж по месяцам', fontsize=16, fontweight='bold')
plt.xlabel('Месяц', fontsize=12)
plt.ylabel('Продажи (тыс. руб)', fontsize=12)
plt.legend(title='Магазин', fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

print("✓ График с линиями показан")


print("\n3. Столбчатая диаграмма с усами ошибок:")

plt.figure(figsize=(12, 6))

# Столбцы со статистикой
sns.barplot(data=df, x='Месяц', y='Продажи', hue='Магазин', 
            errorbar='sd')
"""
errorbar='sd' - показать стандартное отклонение

Чёрные "усики" на столбцах = разброс данных
Длинные усы = большой разброс (нестабильно)
Короткие усы = маленький разброс (стабильно)

Другие варианты:
errorbar='ci' - доверительный интервал
errorbar=None - без усов
"""

plt.title('Средние продажи с отклонениями', fontsize=16, fontweight='bold')
plt.xlabel('Месяц', fontsize=12)
plt.ylabel('Продажи (тыс. руб)', fontsize=12)
plt.legend(title='Магазин')
plt.tight_layout()
plt.show()

print("✓ Столбцы с ошибками показаны")


print("\n4. Violin plot - распределение в виде скрипки:")

plt.figure(figsize=(12, 6))

# Создать "скрипки"
sns.violinplot(data=df, x='Магазин', y='Продажи', hue='Регион', 
               split=True)
"""
Violin plot = box plot + распределение

ЧТО ПОКАЗЫВАЕТ:
- Ширина "скрипки" = сколько значений в этом диапазоне
- Широкая часть = много значений
- Узкая часть = мало значений
- Белая точка внутри = медиана
- Толстая линия = интерквартильный размах

split=True - разделить скрипку на две половины
Левая половина = один регион
Правая половина = другой регион

Это ОЧЕНЬ информативный график!
"""

plt.title('Распределение продаж по магазинам и регионам', 
          fontsize=16, fontweight='bold')
plt.xlabel('Магазин', fontsize=12)
plt.ylabel('Продажи (тыс. руб)', fontsize=12)
plt.tight_layout()
plt.show()

print("✓ Violin plot показан")

print("\n5. Swarm plot - все точки данных:")

plt.figure(figsize=(12, 6))

# Нарисовать ВСЕ точки (не перекрывая друг друга)
sns.swarmplot(data=df, x='Магазин', y='Продажи', hue='Регион', 
              size=8)
"""
Swarm plot = все точки данных, расположенные так, 
чтобы не перекрываться

КАЖДАЯ ТОЧКА = ОДНА СТРОКА В ДАННЫХ

Преимущества:
- Видно ВСЕ данные (не только статистику)
- Видно выбросы
- Видно количество измерений

Недостатки:
- Не подходит для больших данных (>1000 точек)
"""

plt.title('Все точки данных о продажах', fontsize=16, fontweight='bold')
plt.xlabel('Магазин', fontsize=12)
plt.ylabel('Продажи (тыс. руб)', fontsize=12)
plt.legend(title='Регион')
plt.tight_layout()
plt.show()

print("✓ Swarm plot показан")

print("\n6. Pair plot - матрица взаимосвязей:")

# Создать числовые данные для pair plot
numeric_data = pd.DataFrame({
    'Продажи': np.random.randint(100, 300, 50),
    'Расходы': np.random.randint(50, 150, 50),
    'Прибыль': np.random.randint(30, 100, 50),
    'Категория': np.random.choice(['А', 'Б'], 50)
})

# Создать матрицу графиков
sns.pairplot(numeric_data, hue='Категория', diag_kind='kde')
"""
Pair plot - МОЩНЫЙ инструмент анализа!

ЧТО ОН ДЕЛАЕТ:
Для каждой пары столбцов создаёт график

Пример: 3 числовых столбца = 3×3 = 9 графиков

Диагональ (где столбец = самому себе):
- Гистограмма распределения (diag_kind='kde')

Остальные ячейки:
- Scatter plot (связь между двумя переменными)

hue='Категория' - раскрасить по категориям

ПРИМЕНЕНИЕ:
Быстро увидеть все взаимосвязи в данных!
"""

plt.suptitle('Матрица взаимосвязей показателей', 
             fontsize=16, fontweight='bold', y=1.02)
plt.tight_layout()
plt.show()

print("✓ Pair plot показан")

print("\n7. Count plot - подсчёт категорий:")

plt.figure(figsize=(10, 6))

# Посчитать количество записей в каждой категории
sns.countplot(data=df, x='Магазин', hue='Регион')
"""
Count plot = автоматический подсчёт

НЕ НУЖНО считать самостоятельно!

Просто указываем:
x='Магазин' - по какой категории считать
hue='Регион' - как разделить подсчёт

Seaborn САМ:
1. Подсчитает сколько строк для каждого магазина
2. Разделит по регионам
3. Нарисует столбцы
4. Создаст легенду

ОЧЕНЬ УДОБНО для быстрого анализа!
"""

plt.title('Количество записей по магазинам', fontsize=16, fontweight='bold')
plt.xlabel('Магазин', fontsize=12)
plt.ylabel('Количество', fontsize=12)
plt.legend(title='Регион')
plt.tight_layout()
plt.show()

print("✓ Count plot показан")


print("\n8. Point plot - точки с доверительными интервалами:")

plt.figure(figsize=(12, 6))

# Точки со связями и интервалами
sns.pointplot(data=df, x='Месяц', y='Продажи', hue='Магазин', 
              markers=['o', 's', 'D'], linestyles=['-', '--', '-.'])
"""
Point plot похож на line plot, но:
- Показывает среднее (точки)
- Показывает доверительный интервал (усы)
- Соединяет точки линиями

markers=['o', 's', 'D'] - разные маркеры:
  'o' = круг
  's' = квадрат
  'D' = ромб

linestyles=['-', '--', '-.'] - разные линии:
  '-' = сплошная
  '--' = пунктир
  '-.' = штрих-пунктир

Используется для:
- Сравнения средних значений
- Отслеживания трендов
- Оценки различий между группами
"""

plt.title('Средние продажи с доверительными интервалами', 
          fontsize=16, fontweight='bold')
plt.xlabel('Месяц', fontsize=12)
plt.ylabel('Продажи (тыс. руб)', fontsize=12)
plt.legend(title='Магазин')
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

print("✓ Point plot показан")


print("\n9. Joint plot - комбинация scatter + распределения:")

# Создать комбинированный график
sns.jointplot(data=df, x='Продажи', y='Расходы', hue='Регион', 
              kind='scatter', height=8)
"""
Joint plot = 3 графика в одном!

ЦЕНТР:
- Scatter plot (связь между X и Y)

ВЕРХ:
- Гистограмма распределения X (продажи)

СПРАВА:
- Гистограмма распределения Y (расходы)

kind='scatter' - тип центрального графика
Другие варианты:
- 'reg' - с линией регрессии
- 'kde' - плотность распределения
- 'hex' - шестиугольники (для больших данных)

height=8 - размер графика

ПРИМЕНЕНИЕ:
Одновременно видеть связь И распределения!
"""

plt.suptitle('Связь продаж и расходов с распределениями', 
             fontsize=14, fontweight='bold', y=1.02)
plt.tight_layout()
plt.show()

print("✓ Joint plot показан")

# ============================================
# ИТОГИ
# ============================================

print("\n" + "="*60)
print("ИТОГИ - ПРОДВИНУТЫЕ ГРАФИКИ:")
print("="*60)
print("""
1. ГРАФИКИ С СТАТИСТИКОЙ:
   - violinplot() - распределение (скрипка)
   - swarmplot() - все точки данных
   - pointplot() - средние с интервалами

2. КОМБИНИРОВАННЫЕ:
   - pairplot() - матрица взаимосвязей
   - jointplot() - scatter + распределения

3. СПЕЦИАЛЬНЫЕ:
   - countplot() - автоподсчёт категорий

4. КЛЮЧЕВЫЕ ПАРАМЕТРЫ:
   - errorbar= - усы ошибок
   - split= - разделить график
   - markers= - разные маркеры
   - linestyles= - разные линии
   - kind= - тип графика

5. КОГДА ИСПОЛЬЗОВАТЬ:
   - violin - сравнение распределений
   - swarm - мало данных, нужны все точки
   - point - тренды со статистикой
   - pair - быстрый анализ всех связей
   - joint - связь + распределения
   - count - частоты категорий

6. ВАЖНО ПОМНИТЬ:
   - Каждый график показывает данные ПО-СВОЕМУ
   - Выбирайте график под задачу
   - Некоторые графики не подходят для больших данных
   - Всегда добавляйте заголовки и подписи!
""")


print("="*60)